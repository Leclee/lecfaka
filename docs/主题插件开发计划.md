# LecFaka 主题插件系统 — 开发计划

## 项目概述

为 LecFaka 发卡系统构建完整的主题插件体系，包括后端主题引擎、前端动态主题加载、
主题插件包制作、以及插件商店上架（售价 ¥69，需授权）。

---

## 阶段一：后端主题基础设施 ✅

### 1.1 创建 `theme_base.py` — 主题插件基类
- 路径：`backend/app/plugins/sdk/theme_base.py`
- 继承 `PluginBase`
- 定义 `get_theme_config()` 抽象方法返回主题配置
- 主题配置包括：颜色、字体、圆角、间距、阴影等 CSS Variables
- 支持暗色/亮色模式切换

### 1.2 更新 `plugins/__init__.py` — 添加主题注册
- 新增 `THEME_HANDLERS` 注册表
- 在 `_enable_plugin_internal` 中添加 `theme` 类型注册逻辑
- 在 `disable_plugin` 中添加 `theme` 类型注销逻辑
- 新增 `get_active_theme()` 方法获取当前激活的主题

### 1.3 更新 `plugins/sdk/__init__.py` — 导出新基类
- 添加 `ThemePluginBase` 到 `__all__`

### 1.4 创建主题 API 接口
- 路径：`backend/app/api/v1/shop.py` 中增加 `/theme` 端点
- `GET /api/v1/shop/theme` — 返回当前激活主题的完整配置（公开接口，无需登录）
- 返回内容：CSS Variables + Ant Design token 配置

---

## 阶段二：创建高端主题插件包

### 2.1 主题设计（使用 UI/UX Pro Max Skill 生成的设计系统）
- 风格：Liquid Glass + Premium Dark + Gold Accent
- 字体：Cormorant（标题） + Montserrat（正文）
- 主色：`#1C1917`（深石墨色）
- 强调色：`#CA8A04`（金色）
- 支持亮色/暗色两种模式

### 2.2 创建插件文件结构
```
plugins/installed/theme_aurora_premium/
├── plugin.json          # 元数据
├── __init__.py          # 入口类
└── theme.json           # 主题配置数据
```

### 2.3 `plugin.json` 配置
- id: `theme_aurora_premium`
- type: `theme`
- price: 69
- license_required: true
- config_schema: 支持用户自定义部分颜色

### 2.4 `theme.json` 配置
- 完整的 CSS Variables 定义
- Ant Design 5 的 ConfigProvider token 映射
- 亮色/暗色两套色板
- 字体、圆角、阴影等设计令牌

---

## 阶段三：前端主题引擎

### 3.1 创建 ThemeProvider 组件
- 路径：`frontend/src/components/ThemeProvider/`
- 启动时调用 `GET /api/v1/shop/theme` 获取主题配置
- 将 CSS Variables 注入 `document.documentElement`
- 用 Ant Design `ConfigProvider` 包裹 App，传入主题 token

### 3.2 创建 Theme Store (Zustand)
- 路径：`frontend/src/store/theme.ts`
- 存储当前主题配置
- 支持实时切换（管理后台预览用）

### 3.3 更新 `App.tsx`
- 用 `ThemeProvider` 包裹整个应用

### 3.4 更新前台首页和商品详情页
- 使用 CSS Variables 替代硬编码颜色
- 确保主题切换后自动生效

### 3.5 更新前端 API 层
- `frontend/src/api/shop.ts` 增加 `getTheme()` 接口

---

## 阶段四：管理后台主题管理

### 4.1 主题预览功能
- 在插件管理页面，对 `theme` 类型的插件显示"预览"按钮
- 点击后加载主题配置并实时渲染预览

### 4.2 主题切换
- 启用某个 theme 插件时，自动禁用其他已激活的 theme 插件（同时只能有一个活跃主题）
- 禁用 theme 时回退到默认主题

---

## 阶段五：插件商店上架

### 5.1 在 `lecfaka-store` 数据库中添加主题记录
- plugin_id: `theme_aurora_premium`
- price: 69
- type: `theme`
- license_required: true

### 5.2 创建打包脚本（可选）
- 将主题插件目录打包为 zip 供下载

### 5.3 生成授权码接口（已有）
- 利用现有 License 模型生成授权码

---

## 阶段六：测试与打磨

### 6.1 主题切换完整流程测试
### 6.2 授权验证流程测试
### 6.3 响应式和可访问性检查
