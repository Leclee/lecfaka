# LecFaka ä¸»é¢˜æ’ä»¶ç³»ç»Ÿ - å¼€å‘æ–‡æ¡£

## ğŸ“‹ ç³»ç»Ÿæ¦‚è§ˆ

LecFaka ä¸»é¢˜æ’ä»¶ç³»ç»Ÿå…è®¸ç”¨æˆ·é€šè¿‡æ’ä»¶å•†åº—è´­ä¹°å’Œå®‰è£…è‡ªå®šä¹‰ä¸»é¢˜ï¼Œå½»åº•æ”¹å˜å‰å°å•†åŸçš„è§†è§‰é£æ ¼ã€‚ç³»ç»Ÿé‡‡ç”¨ **CSS Variables + Ant Design Token** åŒè½¨æœºåˆ¶ï¼Œå®ç°ä¸»é¢˜çš„åŠ¨æ€åŠ è½½å’Œå®æ—¶åˆ‡æ¢ã€‚

---

## ğŸ— æ¶æ„è®¾è®¡

```mermaid
flowchart TB
    subgraph Backend["åç«¯ (FastAPI)"]
        PM[PluginManager] --> TB[ThemePluginBase]
        TB --> TC[ThemeConfig]
        TC --> CSS[CSS Variables]
        TC --> ANT[Ant Design Token]
        API["GET /api/v1/shop/theme"] --> PM
    end

    subgraph Frontend["å‰ç«¯ (React)"]
        TP[ThemeProvider] --> CS[ConfigProvider<br/>Ant Design]
        TP --> CV[CSS Variables<br/>æ³¨å…¥ DOM]
        TS[ThemeStore<br/>Zustand] --> TP
        API2["getTheme()"] --> TS
        DM[DarkModeToggle] --> TS
    end

    subgraph Store["æ’ä»¶å•†åº— (lecfaka-store)"]
        SP[StorePlugin] --> LIC[License]
    end

    API -.->|HTTP| API2
    PM -.->|æˆæƒéªŒè¯| Store
```

---

## ğŸ“ æ–‡ä»¶ç»“æ„

### åç«¯æ–°å¢/ä¿®æ”¹æ–‡ä»¶

```
backend/app/
â”œâ”€â”€ plugins/
â”‚   â”œâ”€â”€ __init__.py                    # [ä¿®æ”¹] æ–°å¢ THEME_HANDLERSã€ä¸»é¢˜äº’æ–¥ã€get_active_theme()
â”‚   â”œâ”€â”€ sdk/
â”‚   â”‚   â”œâ”€â”€ __init__.py                # [ä¿®æ”¹] å¯¼å‡º ThemePluginBase, ThemeConfig
â”‚   â”‚   â””â”€â”€ theme_base.py             # [æ–°å¢] ä¸»é¢˜æ’ä»¶åŸºç±»ï¼Œå®šä¹‰å®Œæ•´çš„ä¸»é¢˜é…ç½®ä½“ç³»
â”‚   â””â”€â”€ installed/
â”‚       â””â”€â”€ theme_aurora_premium/      # [æ–°å¢] Aurora Premium ä¸»é¢˜æ’ä»¶åŒ…
â”‚           â”œâ”€â”€ plugin.json            #   æ’ä»¶å…ƒæ•°æ®ï¼ˆå”®ä»·$69ã€éœ€æˆæƒï¼‰
â”‚           â””â”€â”€ __init__.py            #   æ’ä»¶å…¥å£ï¼šæ„å»ºå®Œæ•´ä¸»é¢˜é…ç½®
â”œâ”€â”€ api/v1/
â”‚   â””â”€â”€ shop.py                        # [ä¿®æ”¹] æ–°å¢ GET /shop/theme å…¬å¼€æ¥å£
```

### å‰ç«¯æ–°å¢/ä¿®æ”¹æ–‡ä»¶

```
frontend/src/
â”œâ”€â”€ api/
â”‚   â””â”€â”€ shop.ts                        # [ä¿®æ”¹] æ–°å¢ ThemeData ç±»å‹ + getTheme() æ¥å£
â”œâ”€â”€ store/
â”‚   â”œâ”€â”€ index.ts                       # [ä¿®æ”¹] å¯¼å‡º useThemeStore
â”‚   â””â”€â”€ theme.ts                       # [æ–°å¢] ä¸»é¢˜ Zustand Store
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ ThemeProvider/index.tsx         # [æ–°å¢] ä¸»é¢˜æä¾›è€…ï¼ˆåŠ è½½+ç³»ç»Ÿåå¥½ç›‘å¬+ConfigProviderï¼‰
â”‚   â””â”€â”€ DarkModeToggle/index.tsx       # [æ–°å¢] äº®/æš—æ¨¡å¼åˆ‡æ¢æŒ‰é’®
â”œâ”€â”€ styles/
â”‚   â””â”€â”€ index.css                      # [ä¿®æ”¹] å…¨å±€ CSS Variables é»˜è®¤å€¼ + ä¸»é¢˜å·¥å…·ç±»
â”œâ”€â”€ pages/Home/
â”‚   â””â”€â”€ index.tsx                      # [ä¿®æ”¹] å…¨é¢æ”¹é€ ä¸º CSS Variables é©±åŠ¨
â””â”€â”€ App.tsx                            # [ä¿®æ”¹] ç”¨ ThemeProvider åŒ…è£¹åº”ç”¨
```

### æ’ä»¶å•†åº—æ–°å¢æ–‡ä»¶

```
lecfaka-store/app/
â””â”€â”€ seeds/
    â”œâ”€â”€ __init__.py
    â””â”€â”€ seed_aurora_theme.py           # [æ–°å¢] Aurora Premium ä¸Šæ¶ç§å­è„šæœ¬
```

---

## ğŸ”§ æ ¸å¿ƒç»„ä»¶è¯¦è§£

### 1. ThemeConfig (åç«¯ä¸»é¢˜é…ç½®)

```python
@dataclass
class ThemeConfig:
    name: str                              # ä¸»é¢˜åç§°
    mode: str                              # "light" | "dark" | "auto"
    colors: ThemeColors                    # äº®è‰²æ¨¡å¼è‰²æ¿ï¼ˆ18ä¸ªé¢œè‰²å˜é‡ï¼‰
    dark_colors: Optional[ThemeColors]     # æš—è‰²æ¨¡å¼è‰²æ¿ï¼ˆå¯é€‰ï¼‰
    typography: ThemeTypography            # å­—ä½“é…ç½®ï¼ˆå­—ä½“æ ˆ + Google Fonts URLï¼‰
    layout: ThemeLayout                    # å¸ƒå±€é…ç½®ï¼ˆåœ†è§’ã€é«˜åº¦ã€æœ€å¤§å®½åº¦ï¼‰
    effects: ThemeEffects                  # ç‰¹æ•ˆé…ç½®ï¼ˆé˜´å½±ã€æ¯›ç»ç’ƒã€è¿‡æ¸¡åŠ¨ç”»ï¼‰
```

**è¾“å‡ºæ–¹æ³•ï¼š**
| æ–¹æ³• | ç”¨é€” |
|------|------|
| `to_css_variables(dark)` | ç”Ÿæˆ 32 ä¸ª CSS Variables |
| `to_antd_token(dark)` | ç”Ÿæˆ Ant Design 5 ConfigProvider token |
| `to_dict()` | åºåˆ—åŒ–ä¸º API å“åº”æ ¼å¼ |

### 2. ä¸»é¢˜äº’æ–¥æœºåˆ¶ (PluginManager)

```python
# åŒä¸€æ—¶åˆ»åªå…è®¸ä¸€ä¸ªä¸»é¢˜æ¿€æ´»
def enable_plugin(plugin_id):
    if plugin.type == "theme":
        # è‡ªåŠ¨ç¦ç”¨å…¶ä»–å·²æ¿€æ´»çš„ä¸»é¢˜
        for handler_id in list(THEME_HANDLERS.keys()):
            if handler_id != plugin_id:
                disable_plugin(handler_id)
```

### 3. ThemeStore (å‰ç«¯ Zustand)

```
loadTheme() â†’ è°ƒç”¨ API â†’ æ³¨å…¥ CSS Variables â†’ åŠ è½½å­—ä½“ â†’ è®¾ç½® data-theme å±æ€§
setColorMode(mode) â†’ åˆ‡æ¢ CSS Variables + data-theme å±æ€§
getAntdToken() â†’ è¿”å›å½“å‰æ¨¡å¼å¯¹åº”çš„ Ant Design token
```

### 4. ThemeProvider (å‰ç«¯ç»„ä»¶)

```
App å¯åŠ¨ â†’ loadTheme() â†’ ConfigProvider(token) â†’ å­ç»„ä»¶æ¸²æŸ“
                       â†’ æ³¨å…¥ CSS Variables
                       â†’ ç›‘å¬ prefers-color-schemeï¼ˆauto æ¨¡å¼ï¼‰
```

---

## ğŸ¨ Aurora Premium æå…‰ä¸»é¢˜

### è®¾è®¡ç‰¹ç‚¹

| ç‰¹æ€§ | æè¿° |
|------|------|
| **é£æ ¼** | Liquid Glass æ¶²æ€ç»ç’ƒ |
| **è‰²è°ƒ** | æ·±è‰²çŸ³å¢¨ + é‡‘è‰²ç‚¹ç¼€ (#CA8A04) |
| **å­—ä½“** | Cormorant (æ ‡é¢˜) + Montserrat (æ­£æ–‡) |
| **æ¨¡å¼** | äº®è‰² / æš—è‰² åŒæ¨¡å¼ï¼Œå¯è·Ÿéšç³»ç»Ÿ |
| **ç‰¹æ•ˆ** | 16px æ¯›ç»ç’ƒã€cubic-bezier è¿‡æ¸¡ã€å¤šå±‚é˜´å½± |

### å¯é…ç½®é¡¹

| é…ç½®é¡¹ | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|--------|------|
| `accent_color` | color | #CA8A04 | å¼ºè°ƒè‰²/CTA |
| `dark_mode` | select | auto | é»˜è®¤é¢œè‰²æ¨¡å¼ |
| `glass_effect` | switch | true | æ¯›ç»ç’ƒç‰¹æ•ˆ |
| `custom_font` | switch | true | é«˜ç«¯å­—ä½“ï¼ˆGoogle Fontsï¼‰ |

---

## ğŸ”„ æ•°æ®æµ

```mermaid
sequenceDiagram
    participant Browser as æµè§ˆå™¨
    participant React as React App
    participant Store as ThemeStore
    participant API as FastAPI
    participant PM as PluginManager
    participant Theme as Aurora Premium

    Browser->>React: é¡µé¢åŠ è½½
    React->>Store: loadTheme()
    Store->>API: GET /api/v1/shop/theme
    API->>PM: get_active_theme()
    PM->>Theme: theme_config
    Theme-->>PM: ThemeConfig
    PM-->>API: ThemeConfig.to_dict()
    API-->>Store: { theme: {...} }
    Store->>Browser: æ³¨å…¥ CSS Variables
    Store->>React: ConfigProvider(token)
    React->>Browser: æ¸²æŸ“ä¸»é¢˜åŒ–ç•Œé¢

    Note over Browser,React: ç”¨æˆ·ç‚¹å‡»æš—è‰²åˆ‡æ¢
    Browser->>Store: toggleColorMode()
    Store->>Browser: åˆ‡æ¢ CSS Variables (dark)
    Store->>React: æ›´æ–° ConfigProvider(darkToken)
```

---

## ğŸš€ éƒ¨ç½²æŒ‡å—

### 1. åç«¯éƒ¨ç½²

ä¸»é¢˜æ’ä»¶ä¼šéš `PluginManager` è‡ªåŠ¨æ‰«æå’ŒåŠ è½½ï¼Œæ— éœ€é¢å¤–é…ç½®ã€‚

### 2. å•†å“ä¸Šæ¶

```bash
cd lecfaka-store
python -m app.seeds.seed_aurora_theme
```

### 3. ç”¨æˆ·å®‰è£…æµç¨‹

1. ç®¡ç†å‘˜åœ¨åå°ã€Œæ’ä»¶å•†åº—ã€ä¸­æ‰¾åˆ° Aurora Premium
2. ç‚¹å‡»ã€Œå®‰è£…ã€â†’ è¾“å…¥æˆæƒç 
3. åœ¨ã€Œæ’ä»¶ç®¡ç†ã€ä¸­å¯ç”¨ä¸»é¢˜
4. å‰å°è‡ªåŠ¨åŠ è½½æ–°ä¸»é¢˜

---

## ğŸ“ å¼€å‘ä¸»é¢˜æ’ä»¶æŒ‡å—

### æœ€å°ç¤ºä¾‹

```python
from app.plugins.sdk import ThemePluginBase, ThemeConfig, ThemeColors

class Plugin(ThemePluginBase):
    def get_theme_config(self) -> ThemeConfig:
        return ThemeConfig(
            name="æˆ‘çš„ä¸»é¢˜",
            mode="light",
            colors=ThemeColors(
                primary="#1677ff",
                accent="#f5222d",
                background="#ffffff",
                surface="#fafafa",
                text_primary="#000000d9",
            ),
        )
```

### plugin.json æ¨¡æ¿

```json
{
  "id": "theme_my_theme",
  "name": "æˆ‘çš„ä¸»é¢˜",
  "version": "1.0.0",
  "type": "theme",
  "backend": { "entry": "__init__:Plugin" },
  "config_schema": {}
}
```
